---
Description: "Back Rev the bootstrap/dr-provision.zip to allow for upgrades"
Name: "bootstrap-backrev-bootstrap"
ExtraClaims:
  - scope: "*"
    action: "*"
    specific: "*"
Templates:
  - Contents: |-
      #!/bin/bash
      # RackN Copyright 2019

      set -e
      {{template "setup.tmpl" .}}

      echo "Back rev the dr-provision bootstrap zip file to a previous release."

      if drpcli files exists rebar-catalog/drp/v4.1.3.zip 2>/dev/null >/dev/null ; then
        echo "Updating bootstrap zip to v4.1.3"
        drpcli files download rebar-catalog/drp/v4.1.3.zip > v4.1.3.zip
        drpcli files upload v4.1.3.zip as bootstrap/dr-provision.zip
        exit 0
      fi

      if drpcli files exists rebar-catalog/drp/v4.2.0.zip 2>/dev/null >/dev/null ; then
        echo "Updating bootstrap zip to v4.2.0"
        drpcli files download rebar-catalog/drp/v4.2.0.zip > v4.2.0.zip
        drpcli files upload v4.2.0.zip as bootstrap/dr-provision.zip
        exit 0
      fi

      if drpcli files exists rebar-catalog/drp/v4.2.1.zip 2>/dev/null >/dev/null ; then
        echo "Updating bootstrap zip to v4.2.1"
        drpcli files download rebar-catalog/drp/v4.2.1.zip > v4.2.1.zip
        drpcli files upload v4.2.1.zip as bootstrap/dr-provision.zip
        exit 0
      fi

      echo "Failed to find v4.1.3, v4.2.0, or v4.2.1 in the catalog."
      exit 1
    Name: "backrev-setup"
Meta:
  icon: "spy"
  color: "purple"
  title: "Digital Rebar Community Content"
  feature-flags: "sane-exit-codes"
